<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forex Point Spread Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* Optional: Add some basic styling for better presentation */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        form {
            margin-bottom: 30px;
        }
        label {
            display: inline-block;
            width: 200px;
            margin-bottom: 10px;
        }
        input {
            padding: 5px;
            width: 200px;
        }
        button {
            padding: 10px 20px;
            margin-top: 10px;
        }
        #result img {
            max-width: 100%;
            height: auto;
            margin-bottom: 20px;
        }
        #statistics {
            background-color: #f9f9f9;
            padding: 15px;
            border: 1px solid #ddd;
        }
        .stat-section {
            margin-bottom: 20px;
        }
        .stat-section h3 {
            margin-bottom: 10px;
        }
        .stat-section table {
            width: 100%;
            border-collapse: collapse;
        }
        .stat-section table, .stat-section th, .stat-section td {
            border: 1px solid #ccc;
        }
        .stat-section th, .stat-section td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Forex Point Spread Analysis</h1>
    <form id="data-form">
        <label for="date">Select Date:</label>
        <input type="date" id="date" name="date" required><br><br>

        <label for="symbol">Enter Symbol:</label>
        <input type="text" id="symbol" name="symbol" value="XAU/USD" required><br><br>

        <label for="trade_vol">Enter Trading Volume:</label>
        <input type="number" id="trade_vol" name="trade_vol" value="300" required><br><br>

        <label for="maker_id">Select Market Maker:</label>
        <input type="text" id="maker_id" name="maker_id" value="Britannia" required><br><br>

        <button type="submit">Analyze</button>
    </form>

    <div id="result">
        <h2>Plots:</h2>
        <img id="plot1" alt="Point Spread Plot 1" style="display:none;">
        <img id="plot2" alt="Point Spread Plot 2" style="display:none;">
        
        <h2>Statistics:</h2>
        <div id="statistics" style="display:none;">
            <div class="stat-section" id="describe-default">
                <h3>Describe (Default Percentiles)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Statistic</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="stat-section" id="describe-custom">
                <h3>Describe (Custom Percentiles)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Statistic</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="stat-section" id="specific-stats">
                <h3>Specific Statistics</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Statistic</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="stat-section" id="outlier-info">
                <h3>Outlier Information</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Statistic</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('data-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData(e.target);

            try {
                const response = await axios.post('/get_data', formData);
                if (response.data.status === 'success') {
                    // Display Plot 1
                    const plot1 = document.getElementById('plot1');
                    plot1.src = response.data.plot1_url;
                    plot1.style.display = 'block';

                    // Display Plot 2
                    const plot2 = document.getElementById('plot2');
                    plot2.src = response.data.plot2_url;
                    plot2.style.display = 'block';

                    // Display Statistics
                    const stats = response.data.statistics;
                    document.getElementById('statistics').style.display = 'block';

                    // Populate Describe Default Percentiles
                    const describeDefaultBody = document.querySelector('#describe-default tbody');
                    describeDefaultBody.innerHTML = ''; // Clear existing rows
                    for (const [key, value] of Object.entries(stats.describe_default)) {
                        const row = document.createElement('tr');
                        const cellKey = document.createElement('td');
                        cellKey.textContent = key;
                        const cellValue = document.createElement('td');
                        cellValue.textContent = value;
                        row.appendChild(cellKey);
                        row.appendChild(cellValue);
                        describeDefaultBody.appendChild(row);
                    }

                    // Populate Describe Custom Percentiles
                    const describeCustomBody = document.querySelector('#describe-custom tbody');
                    describeCustomBody.innerHTML = ''; // Clear existing rows
                    for (const [key, value] of Object.entries(stats.describe_custom)) {
                        const row = document.createElement('tr');
                        const cellKey = document.createElement('td');
                        cellKey.textContent = key;
                        const cellValue = document.createElement('td');
                        cellValue.textContent = value;
                        row.appendChild(cellKey);
                        row.appendChild(cellValue);
                        describeCustomBody.appendChild(row);
                    }

                    // Populate Specific Statistics
                    const specificStatsBody = document.querySelector('#specific-stats tbody');
                    specificStatsBody.innerHTML = ''; // Clear existing rows
                    for (const [key, value] of Object.entries(stats.specific_stats)) {
                        const row = document.createElement('tr');
                        const cellKey = document.createElement('td');
                        cellKey.textContent = key;
                        const cellValue = document.createElement('td');
                        cellValue.textContent = value;
                        row.appendChild(cellKey);
                        row.appendChild(cellValue);
                        specificStatsBody.appendChild(row);
                    }

                    // Populate Outlier Information
                    const outlierInfoBody = document.querySelector('#outlier-info tbody');
                    outlierInfoBody.innerHTML = ''; // Clear existing rows
                    for (const [key, value] of Object.entries(stats.outlier_info)) {
                        const row = document.createElement('tr');
                        const cellKey = document.createElement('td');
                        cellKey.textContent = key;
                        const cellValue = document.createElement('td');
                        cellValue.textContent = value;
                        row.appendChild(cellKey);
                        row.appendChild(cellValue);
                        outlierInfoBody.appendChild(row);
                    }

                } else {
                    alert(response.data.message);
                }
            } catch (error) {
                console.error(error);
                alert('An error occurred: ' + error);
            }
        });
    </script>
</body>
</html>